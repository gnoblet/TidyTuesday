{
  "hash": "847cd1b3c2b9cd49fff7b400d848309e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Crane Migration Patterns: A Polar View of Seasonal Observations\"\nsubtitle: \"TidyTuesday 2025-09-30 - Polar Coordinate Analysis\"\ndate: \"2025-10-01\"\nauthor: \"gnoblet\"\ncategories: [r, ggplot2, tidyverse, polar-coordinates, seasonal-analysis]\nimage: \"polar_plot.svg\"\n---\n\n## Overview\n\nThis analysis explores crane observations at Lake Hornborgasjön, Sweden using polar coordinates to visualize seasonal migration patterns across multiple years (1994-2024). Inspired by climate change time series visualizations, this approach reveals the cyclical nature of crane migration and allows us to see how observation patterns have changed over three decades.\n\n## Dataset\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get data\nlibrary(tidytuesdayR)\ndat <- tt_load(\"2025-09-30\")\ncranes <- dat$cranes\n\n# Load required libraries\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(lubridate)\nlibrary(showtext)\nlibrary(sysfonts)\nlibrary(viridis)\nlibrary(scales)\n\n# Add Google Fonts for better typography\nfont_add_google(\"Source Sans Pro\", \"source\")\nfont_add_google(\"Roboto Condensed\", \"roboto\")\nshowtext_auto()\nshowtext_opts(dpi = 300)\n```\n:::\n\n\n## Data Preparation\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Prepare the data for polar visualization\ncranes_prepared <- cranes %>%\n  mutate(\n    year = year(date),\n    month = month(date),\n    day = day(date),\n    # Create day of year (1-365/366)\n    day_of_year = yday(date),\n    # Normalize to 0-1 for polar coordinates (full circle)\n    time_normalized = (day_of_year - 1) / 365.25,\n    # Create observation intensity (log scale for better visualization)\n    obs_log = log10(observations + 1),\n    # Focus on migration seasons (Feb-May, Aug-Nov)\n    season = case_when(\n      month %in% 2:5 ~ \"Spring\",\n      month %in% 8:11 ~ \"Autumn\",\n      TRUE ~ \"Other\"\n    )\n  ) %>%\n  filter(season != \"Other\", year >= 1994) %>%\n  # Add year grouping for color coding\n  mutate(\n    year_group = case_when(\n      year >= 2020 ~ \"2020-2024\",\n      year >= 2010 ~ \"2010-2019\",\n      year >= 2000 ~ \"2000-2009\",\n      TRUE ~ \"1994-1999\"\n    )\n  )\n\n# Create monthly averages for smoother visualization\ncranes_monthly <- cranes_prepared %>%\n  group_by(year, month) %>%\n  summarise(\n    observations_avg = mean(observations, na.rm = TRUE),\n    obs_log = log10(observations_avg + 1),\n    day_of_year = mean(day_of_year),\n    time_normalized = (day_of_year - 1) / 365.25,\n    season = first(season),\n    year_group = first(year_group),\n    .groups = 'drop'\n  ) %>%\n  filter(!is.na(observations_avg))\n```\n:::\n\n\n## Polar Visualization Function\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncreate_polar_crane_plot <- function(data, title, subtitle = \"\") {\n  # Create year-specific colors\n  years_range <- range(data$year)\n  n_years <- length(unique(data$year))\n\n  # Use a custom color palette emphasizing recent years\n  colors <- c(\n    viridis(n_years - 5, alpha = 0.6, option = \"D\"),\n    viridis(5, alpha = 0.9, option = \"C\")\n  )\n\n  # Create the base plot\n  p <- ggplot(\n    data,\n    aes(x = time_normalized, y = observations_avg, group = year)\n  ) +\n    geom_line(\n      aes(\n        color = factor(year),\n        linewidth = ifelse(year >= 2020, 1.2, 0.6),\n        alpha = ifelse(year >= 2020, 0.9, 0.7)\n      ),\n      lineend = \"round\"\n    ) +\n    # Add points for recent years to highlight them\n    geom_point(\n      data = filter(data, year >= 2020),\n      aes(color = factor(year)),\n      size = 0.8,\n      alpha = 0.8\n    ) +\n    coord_polar(theta = \"x\") +\n    scale_color_viridis_d(option = \"plasma\", name = \"Year\") +\n    scale_linewidth_identity() +\n    scale_alpha_identity() +\n    scale_x_continuous(\n      breaks = seq(0, 11 / 12, by = 1 / 12),\n      labels = month.abb,\n      limits = c(0, 1)\n    ) +\n    scale_y_continuous(\n      labels = comma_format(),\n      expand = expansion(mult = c(0.1, 0.1))\n    ) +\n    labs(\n      title = title,\n      subtitle = subtitle,\n      caption = \"Data: TidyTuesday 2025-09-30 | Visualization: gnoblet\",\n      y = \"Average Monthly Observations\"\n    ) +\n    theme_void() +\n    theme(\n      text = element_text(family = \"source\"),\n      plot.title = element_text(\n        size = 20,\n        hjust = 0.5,\n        margin = margin(b = 10),\n        family = \"roboto\",\n        face = \"bold\"\n      ),\n      plot.subtitle = element_text(\n        size = 14,\n        hjust = 0.5,\n        margin = margin(b = 20),\n        color = \"grey30\"\n      ),\n      plot.caption = element_text(\n        size = 10,\n        hjust = 0.5,\n        margin = margin(t = 20),\n        color = \"grey50\"\n      ),\n      axis.text.x = element_text(\n        size = 12,\n        color = \"grey20\",\n        margin = margin(t = 5)\n      ),\n      axis.text.y = element_text(\n        size = 10,\n        color = \"grey40\"\n      ),\n      axis.title.y = element_text(\n        size = 12,\n        color = \"grey20\",\n        margin = margin(r = 10)\n      ),\n      legend.position = \"none\",\n      panel.grid.major.x = element_line(color = \"grey90\", size = 0.3),\n      panel.grid.major.y = element_line(color = \"grey90\", size = 0.3),\n      panel.grid.minor = element_blank(),\n      plot.background = element_rect(fill = \"white\", color = NA),\n      panel.background = element_rect(fill = \"white\", color = NA)\n    )\n\n  return(p)\n}\n```\n:::\n\n\n## Main Polar Visualization\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create the main polar plot\npolar_plot <- create_polar_crane_plot(\n  cranes_monthly,\n  title = \"Crane Migration Cycles at Lake Hornborgasjön\",\n  subtitle = \"Monthly averages across 30 years (1994-2024) • Polar coordinates reveal seasonal patterns\"\n)\n\nprint(polar_plot)\n```\n\n::: {.cell-output-display}\n![](week_39_polar_files/figure-html/main-polar-plot-1.png){width=1152}\n:::\n\n```{.r .cell-code}\n# Save the plot\nggsave(\n  \"polar_plot.png\",\n  polar_plot,\n  width = 12,\n  height = 12,\n  dpi = 300,\n  bg = \"white\"\n)\n```\n:::\n\n\n## Focused Analysis: Peak Migration Years\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Identify peak migration years for comparison\npeak_years <- cranes_monthly %>%\n  group_by(year) %>%\n  summarise(total_obs = sum(observations_avg), .groups = 'drop') %>%\n  slice_max(total_obs, n = 5) %>%\n  pull(year)\n\nrecent_years <- c(2020, 2021, 2022, 2023, 2024)\n\ncomparison_years <- c(peak_years, recent_years) %>% unique() %>% sort()\n\n# Create focused plot with selected years\nfocused_data <- cranes_monthly %>%\n  filter(year %in% comparison_years) %>%\n  mutate(\n    year_category = ifelse(year %in% recent_years, \"Recent\", \"Peak Historical\"),\n    year_label = paste0(year, \" (\", year_category, \")\")\n  )\n\nfocused_plot <- ggplot(\n  focused_data,\n  aes(x = time_normalized, y = observations_avg)\n) +\n  geom_line(\n    aes(\n      color = year_category,\n      group = year,\n      linewidth = ifelse(year_category == \"Recent\", 1.2, 0.8),\n      alpha = ifelse(year_category == \"Recent\", 0.9, 0.7)\n    ),\n    lineend = \"round\"\n  ) +\n  geom_point(\n    aes(color = year_category),\n    size = 1.5,\n    alpha = 0.8\n  ) +\n  coord_polar(theta = \"x\") +\n  scale_color_manual(\n    values = c(\"Recent\" = \"#E31A1C\", \"Peak Historical\" = \"#1F78B4\"),\n    name = \"Period\"\n  ) +\n  scale_linewidth_identity() +\n  scale_alpha_identity() +\n  scale_x_continuous(\n    breaks = seq(0, 11 / 12, by = 1 / 12),\n    labels = month.abb,\n    limits = c(0, 1)\n  ) +\n  scale_y_continuous(\n    labels = comma_format(),\n    expand = expansion(mult = c(0.1, 0.1))\n  ) +\n  labs(\n    title = \"Peak vs Recent Years: Crane Migration Patterns\",\n    subtitle = \"Comparing highest historical observations with recent years (2020-2024)\",\n    caption = \"Data: TidyTuesday 2025-09-30 | Visualization: gnoblet\",\n    y = \"Average Monthly Observations\"\n  ) +\n  theme_void() +\n  theme(\n    text = element_text(family = \"source\"),\n    plot.title = element_text(\n      size = 18,\n      hjust = 0.5,\n      margin = margin(b = 10),\n      family = \"roboto\",\n      face = \"bold\"\n    ),\n    plot.subtitle = element_text(\n      size = 14,\n      hjust = 0.5,\n      margin = margin(b = 20),\n      color = \"grey30\"\n    ),\n    plot.caption = element_text(\n      size = 10,\n      hjust = 0.5,\n      margin = margin(t = 20),\n      color = \"grey50\"\n    ),\n    axis.text.x = element_text(size = 12, color = \"grey20\"),\n    axis.text.y = element_text(size = 10, color = \"grey40\"),\n    axis.title.y = element_text(\n      size = 12,\n      color = \"grey20\",\n      margin = margin(r = 10)\n    ),\n    legend.position = c(0.85, 0.15),\n    legend.background = element_rect(fill = \"white\", alpha = 0.8),\n    panel.grid.major.x = element_line(color = \"grey90\", size = 0.3),\n    panel.grid.major.y = element_line(color = \"grey90\", size = 0.3),\n    panel.grid.minor = element_blank(),\n    plot.background = element_rect(fill = \"white\", color = NA)\n  )\n\nprint(focused_plot)\n```\n\n::: {.cell-output-display}\n![](week_39_polar_files/figure-html/peak-years-analysis-1.png){width=960}\n:::\n\n```{.r .cell-code}\n# Save focused plot\nggsave(\n  \"focused_polar_plot.png\",\n  focused_plot,\n  width = 10,\n  height = 10,\n  dpi = 300,\n  bg = \"white\"\n)\n```\n:::\n\n\n## Key Insights\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate some summary statistics\nmigration_stats <- cranes_monthly %>%\n  group_by(season, year) %>%\n  summarise(\n    peak_observations = max(observations_avg),\n    total_observations = sum(observations_avg),\n    .groups = 'drop'\n  ) %>%\n  group_by(season) %>%\n  summarise(\n    avg_peak = mean(peak_observations),\n    max_peak = max(peak_observations),\n    avg_total = mean(total_observations),\n    years_covered = n_distinct(year),\n    .groups = 'drop'\n  )\n\nprint(\"Migration Pattern Summary:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Migration Pattern Summary:\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(migration_stats)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 5\n  season avg_peak max_peak avg_total years_covered\n  <chr>     <dbl>    <dbl>     <dbl>         <int>\n1 Autumn    7848.    16810    14259.            23\n2 Spring    7558.    15230    11468.            31\n```\n\n\n:::\n\n```{.r .cell-code}\n# Trend analysis\nyearly_trends <- cranes_monthly %>%\n  group_by(year) %>%\n  summarise(\n    annual_peak = max(observations_avg),\n    annual_total = sum(observations_avg),\n    spring_total = sum(ifelse(season == \"Spring\", observations_avg, 0)),\n    autumn_total = sum(ifelse(season == \"Autumn\", observations_avg, 0)),\n    .groups = 'drop'\n  )\n\ncat(\"\\nPeak observation years:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nPeak observation years:\n```\n\n\n:::\n\n```{.r .cell-code}\nyearly_trends %>%\n  slice_max(annual_peak, n = 5) %>%\n  select(year, annual_peak) %>%\n  print()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 2\n   year annual_peak\n  <dbl>       <dbl>\n1  2023      16810 \n2  2019      15230 \n3  2024      13873.\n4  2021      12580 \n5  2014      12217.\n```\n\n\n:::\n:::\n\n\n## Analysis Summary\n\nThe polar coordinate visualization reveals several fascinating patterns in crane migration at Lake Hornborgasjön:\n\n1. **Distinct Seasonal Cycles**: The circular plot clearly shows the bimodal distribution with peaks in spring (April-May) and autumn (September-October) migration periods.\n\n2. **Year-to-Year Variation**: The different colored lines demonstrate significant variation between years, with some years showing much higher peak observations than others.\n\n3. **Recent Trends**: The comparison between peak historical years and recent years (2020-2024) suggests changes in migration patterns, possibly related to climate change or habitat modifications.\n\n4. **Spring vs Autumn**: The data suggests differences between spring and autumn migration intensities, with spring often showing higher peak counts.\n\nThe polar coordinate approach effectively captures the cyclical nature of migration while allowing easy comparison across multiple years, making temporal patterns immediately visible in a way that traditional linear time series might obscure.\n\n## Visualizations\n\n![Main Polar Plot](polar_plot.png)\n\n![Focused Comparison](focused_polar_plot.png)\n",
    "supporting": [
      "week_39_polar_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}